{"version":3,"sources":["build.js"],"names":[],"mappings":"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","file":"compiled.js","sourcesContent":["var PedanticCount = require('pedantic-count');\nconst catMap = new Map();\nconst typeMap = new Map();\nconst dataMap = new Map();\nconst productInstances = new Map();\nconst bucketInstances = new Map(); \nconst cartMap = new WeakMap();\nconst countersMap = new WeakMap();\nconst choiceMap  = new WeakMap();\n\nconst shippingCosts = new Map();\nshippingCosts.set('furniture', { min: 500, below: [ 65, 150, 250 ],above: [ 0, 85, 150 ] })\nshippingCosts.set('small-furniture', { min: 500, below: [ 18, 25, 28 ],above: [ 0, 10, 15 ] })\nshippingCosts.set('accessories', { min: 50, below: [ 15, 15, 15 ],above: [ 0, 0,0  ] })\n\n\nclass Cart{\n  \n  constructor( counts, cart ){\n    this.tokens = new Map();\n    this.products = new Map();\n    this.zone = null;\n    this.discounts = [];\n    this.userLevel=false;\n    countersMap.set( this, counts );\n  }\n  \n  setUserLevel( userLevel){\n    return  this.userLevel =  userLevel;\n  }\n  addCoupon( percent ){\n    return this.discounts.push(percent);\n  }\n  \n  removeCoupon( percent ){\n    return this.discounts = this.discounts.filter( (d)=>{\n      return d !== percent;\n    });\n  }\n  \n  get discountCost(){\n    if( this.itemCost <= 0){\n      return 0;\n    }\n    var userLevelDiscount = !this.userLevel ? 0 : this.userLevel === 'VIP' ? 0.05 : this.userLevel === 'VVIP' ? 0.10 : this.userLevel === 'VVVIP' ? 0.15 : 0;\n    return [userLevelDiscount].concat(this.discounts).reduce( (t , d )=>{\n      return d === 0 ? t : t + (this.itemCost * -d);\n    }, 0);\n  }\n  \n  setZone( string ){\n    this.zone = string == 'zone-1' ? 0 : string == 'zone-2' ? 1 : 2;\n    return true;\n  }\n  \n  setZoneFromPostalCode( postcode ){\n    \n    postcode = postcode.toUpperCase().trim();\n    \n    var zones_table = {\n      'zone-1': /^(H..|G1.|M..|K1.|T2.|T3.|T5.|T6.|V5.|V6.|C1A|R2.|R3.|E2.|E1.|E3.|B3.|S7.|S4.|A1.|J4.).+$/,\n      'zone-3': /^(J|G|K|L|N|P|T|V|C|R|E|B|S|A|Y|X)0.+$/,\n    }\n    if(!/^([a-zA-Z]\\d[a-zA-Z]\\s?\\d[a-zA-Z]\\d)$/.test(postcode)){\n      return this.setZone( 'zone-3');\n    }\n    var found = 'zone-2';\n    Object.keys(zones_table).forEach( ( zone )=>{\n      var regex = zones_table[zone];\n      if(regex.test(postcode)){\n        found = zone;\n      }\n    });\n    \n    return this.setZone( found );\n  }\n\n  get shippingZone(){\n    if(this.zone === null){\n      return 'n/a';\n    }\n    return `zone-${this.zone+1}`;\n  }\n  \n  get total(){\n    var t =  this.itemCost + this.taxCost + this.shippingCost + this.discountCost;\n    if(isNaN(t)) return 'n/a';\n    return t;\n  }\n  get taxCost(){\n    if(this.zone === null ){\n      return 'n/a';\n    }\n    return this.itemCost == 0 ? 0 : this.itemCost * 0.15;\n  }\n  get shippingCost(){\n    if(this.zone === null){\n      return 'n/a';\n    }\n    var zone = this.zone;\n    var itemCost = this.itemCost;\n    var shippingClass = 'accessories';\n    this.tokens.forEach( ( cartItem, token )=>{\n      var sclass = cartItem.shippingClass;\n      // console.log(sclass)\n      if(shippingClass == 'accessories' && sclass == 'small-furniture'){\n        shippingClass = sclass;\n      }\n      if(( shippingClass == 'small-furniture'  || shippingClass == 'accessories' )&& sclass == 'furniture'){\n        shippingClass = sclass;\n      }\n    });\n    var rules = shippingCosts.get( shippingClass );\n    // console.log(currentPrice >= rules.min ? 'above' : 'bellow', currentPrice, rules.min )\n    if( itemCost >= rules.min ){\n      return rules.above[zone];\n    }else{\n      return rules.below[zone];\n    }\n  }\n  \n  get productCount(){\n    return this.products.size;\n  }\n  \n  get itemCount(){\n    return this.tokens.size;\n  }\n  \n  hasProduct( id ){\n    return this.products.has( typeof id == 'number' ? id : id.id );\n  }\n  \n  \n  incrItemQuantity( cartItem, qty ){\n    \n      cartItem.updateChoices.forEach( (choice, name )=>{\n        if(name !== 'quantity'){\n          var option = choice.getOption(cartItem.choices[name]);\n          if( option instanceof Set ){\n            option.forEach( ( o )=>{\n              o.incrCartCount( qty );\n            })  \n          }else{\n            option.incrCartCount( qty );  \n          }\n        }\n      });\n      cartItem.choices.quantity+=qty;\n      return true;\n  }\n  \n  decrItemQuantity( cartItem, qty ){\n    // console.log('DECR')\n    cartItem.updateChoices.forEach( (choice, name )=>{\n      if(name !== 'quantity'){\n        var option = choice.getOption(cartItem.choices[name]);\n        if( option instanceof Set ){\n          option.forEach( ( o )=>{\n            o.decrCartCount( qty );\n          })  \n        }else{\n          option.decrCartCount( qty );  \n        }\n      }\n    });\n    cartItem.choices.quantity-=qty;\n    return true;\n  }\n  \n  \n  get itemCost(){\n    var total = 0.0;\n    this.tokens.forEach( ( cartItem, t)=>{\n      total += cartItem.itemCost;\n    })\n    return total;\n  }\n  \n  addItem( product ){\n    var it = this;\n    var selections = Object.assign({},product.selections);\n    var id = product.id;\n    var qty = selections.quantity;\n    delete selections.quantity;\n    \n    var data = { id: id, choices: selections, unitPrice: product.currentPrice };\n    var token = JSON.stringify( data );\n    Object.assign(data.choices, { quantity: 0 } );\n    var cartItem = Object.assign( data, { \n      token: token, \n      choices: data.choices,\n      shippingClass: product.shippingClass,\n      updateChoices: product.choices,\n      incr: function ( qty ){\n                \n              return !!it.incrItemQuantity( cartItem, qty );\n            },\n      decr: function  ( qty ){\n              return !!it.decrItemQuantity( cartItem, qty );\n            },\n      remove: function( qty ){\n                return !!it.removeItem( cartItem );\n              }\n    } );\n    Object.defineProperties( cartItem, {\n      minRegularPrice: { get: function(){\n        var qty = this.choices.quantity === 0 ? 1 : this.choices.quantity;\n        return product.minRegularPrice * qty;\n      }},\n      maxRegularPrice: { get: function(){\n        var qty = this.choices.quantity=== 0 ? 1 : this.choices.quantity;\n        return product.maxRegularPrice* qty;\n      }},\n      minPrice: {get: function(){\n        var qty = this.choices.quantity=== 0 ? 1 : this.choices.quantity;\n        return product.minPrice* qty;\n      }},\n      maxPrice: {get: function(){\n        var qty = this.choices.quantity=== 0 ? 1 : this.choices.quantity;\n        return product.maxPrice* qty;\n      }},\n      itemCost: {get: function(){\n        var qty = this.choices.quantity=== 0 ? 1 : this.choices.quantity;\n        return this.unitPrice * qty;\n      }}\n    });\n    if(!this.products.has(id)){\n      this.products.set( id, []);\n    }\n    // Object.assign(cartItem.choices, data.choices, { quantity: 0 });\n    this.products.get( id ).push( token );\n    this.tokens.set(token, cartItem );\n    cartItem.incr( qty );\n    // console.log('cart now has %d items', this.tokens.size )\n    return this.tokens.get( token );\n  }\n  \n  removeItem( cartItem ){\n    cartItem.decr( cartItem.choices.quantity );\n    var tokens = this.products.get(cartItem.id);\n    var newTokens = tokens.filter( ( t )=>{\n                      return t !== cartItem.token;\n                    });\n    if( newTokens.length == 0){\n      this.products.delete( cartItem.id );\n    }else{\n      this.products.set(cartItem.id, newTokens  );  \n    }\n    this.tokens.delete(cartItem.token);\n    return true;\n  }\n  \n  reset(){\n    this.tokens.forEach( ( cartItem )=>{\n      this.removeItem(cartItem);\n    })\n    this.zone = null;\n    return true;\n  }\n  \n  \n}\n\n\nclass Product{\n  constructor( id, counts, cart ){\n    this.id = id;\n    cartMap.set( this, cart );\n    countersMap.set( this, counts );\n    var vids = dataMap.get( this.id ).variations;\n    if(vids && vids.length){\n      vids.forEach( ( vid )=>{\n        productInstances.set( vid, new Product.Variation( vid, this, counts ) );\n      })  \n    }\n    Object.defineProperty( this, 'name', { enumerable: true, configurable: true, value: this.name } );\n    Object.defineProperty( this, 'description', { enumerable: true, configurable: true, value: this.description } );\n    Object.defineProperty( this, 'image', { enumerable: true, configurable: true, value: this.image } );\n    Object.defineProperty( this, 'images', { enumerable: true, configurable: true, value: this.images } );\n    Object.defineProperty( this, 'type', { enumerable: true, configurable: true, value: this.type } );\n    Object.defineProperty( this, 'wireframe', { enumerable: true, configurable: true, value: this.wireframe } );\n    Object.defineProperty( this, 'anatomy', { enumerable: true, configurable: true, value: this.anatomy } );\n    Object.defineProperty( this, 'why_we_love', { enumerable: true, configurable: true, value: this.why_we_love } );\n    // Object.defineProperty( this, 'minRegularPrice', { enumerable: true, configurable: true, value: this.minRegularPrice } );\n    // Object.defineProperty( this, 'maxRegularPrice', { enumerable: true, configurable: true, value: this.maxRegularPrice } );\n    // Object.defineProperty( this, 'maxSalePrice', { enumerable: true, configurable: true, value: this.maxSalePrice } );\n    // Object.defineProperty( this, 'maxSalePrice', { enumerable: true, configurable: true, value: this.maxSalePrice } );\n  }\n  \n  get shippingClass(){\n    return 'furniture';\n  }\n  \n  get name(){\n    return dataMap.get( this.id ).name;\n  }\n  \n  get description(){\n    return  dataMap.get( this.id ).description;\n  }\n  \n  get why_we_love(){\n    return {\n      title: this.meta.why_we_love_title,\n      content: this.meta.why_we_love_content,\n    }\n  }\n  \n  get wireframe(){\n    if(!this.meta.wireframe) return {src: null, colors: [] };\n    return {\n      src: this.meta.wireframe.src, colors: this.meta.wireframe.colors||[]\n    }\n  }\n  \n  get anatomy(){\n    var enfr = {};\n    if(!this.meta.anatomy_en){\n      enfr.en = {src: null, colors: [] };\n    }else{\n     enfr.en = {src: this.meta.anatomy_en.src, colors: this.meta.anatomy_en.colors||[] }; \n    }\n    if(!this.meta.anatomy_fr){\n      enfr.fr = {src: null, colors: [] };\n    }else{\n      enfr.fr = {src: this.meta.anatomy_fr.src, colors: this.meta.anatomy_fr.colors||[] }; \n    }\n    return enfr;\n  }\n  \n  get basePrice(){\n    if(!this.meta.base_price &&  1*this.meta.base_price !== 0){\n      return null;\n    }\n    return parseInt(this.meta.base_price)\n  }\n\n  get meta(){\n    var meta_box = dataMap.get( this.id ).meta_box;\n    if(!meta_box){\n      return {};\n    }\n    return Object.keys(meta_box).reduce( ( keep, key )=>{\n      if(/edb_/.test(key)){\n        keep[key.replace(/edb_/,'')] = meta_box[key];\n      }else{\n        keep[key.replace(/^_/,'')] = meta_box[key];\n      }\n      return keep;\n    }, {} );\n    \n  }\n  \n  get image(){\n    var images = dataMap.get( this.id ).images;\n    if(images.length){\n      return { src: images[0].src, colors: images[0].colors||[] };\n    }\n    return { src: null, colors: [] };\n  }\n  get images(){\n    var images = dataMap.get( this.id ).images;\n    if(images.length){\n      return images.slice(1).map( ( img )=>{\n        return { src: img.src, colors: img.colors||[] };\n      })\n    }\n    return [];\n  }\n  \n  get type(){\n    return typeMap.get( this.id );\n  }\n  \n  get minRegularPrice(){\n    var choicePrice = new PedanticCount.LoggingCount( 0 );\n    if( this.choices){\n      this.choices.forEach( ( choice, name )=>{\n        // console.log(choice.minRegularPrice)\n        if(name !== 'quantity'){\n          choicePrice.incr( choice.minRegularPrice, `add ${choice.name}'s min regular price of $`);  \n        }\n      });\n    }\n    if( this.basePrice !== null ){\n      choicePrice.incr(this.basePrice, `add the base unit price of $${this.basePrice}` ) ;\n    }\n    return choicePrice;\n  }\n  \n  get maxRegularPrice(){\n    var choicePrice = new PedanticCount.LoggingCount(0 );\n    if( this.choices){\n      this.choices.forEach( ( choice, name )=>{\n        if(name !== 'quantity'){\n          choicePrice.incr( choice.maxRegularPrice, `add ${choice.name}'s max regular price of $`);  \n        }\n      });\n    }\n    if( this.basePrice !== null ){\n      choicePrice.incr(this.basePrice, `add the base unit price of $${this.basePrice}` ) ;\n    }\n    return choicePrice;\n  }\n  \n  get minSalePrice(){\n    var choicePrice = new PedanticCount.LoggingCount(0 );\n    if( this.choices){\n      this.choices.forEach( ( choice, name )=>{\n        if(name !== 'quantity'){\n          choicePrice.incr( choice.minSalePrice, `add ${choice.name}'s min sale price of $`);  \n        }\n      });\n    }\n    if( this.basePrice !== null ){\n      choicePrice.incr(this.basePrice, `add the base unit price of $${this.basePrice}` ) ;\n    }\n    return choicePrice;\n  }\n  \n  get maxSalePrice(){\n    var choicePrice = new PedanticCount.LoggingCount(0 );\n    if( this.choices){\n      this.choices.forEach( ( choice, name )=>{\n        if(name !== 'quantity'){\n          choicePrice.incr( choice.maxSalePrice, `add ${choice.name}'s max sale price of $`);  \n        }\n      });\n    }\n    if( this.basePrice !== null ){\n      choicePrice.incr(this.basePrice, `add the base unit price of $${this.basePrice}` ) ;\n    }\n    return choicePrice;\n  }\n  \n  get minPrice(){\n    return  Math.min( this.minSalePrice, this.minRegularPrice );\n  }\n  \n  get maxPrice(){\n    return  Math.max( this.maxSalePrice, this.maxRegularPrice );\n  }\n  \n  get currentPrice(){\n    var choicePrice = new PedanticCount.LoggingCount(0 );\n    if( this.choices){\n      this.choices.forEach( ( choice, name )=>{\n        if(name !== 'quantity'){\n            if(choice.selectedOption !== null){\n              choicePrice.incr(choice.selectedOption.price,`add ${choice.name}'s current price of $`)  \n            }else{\n              choicePrice.incr(choice.minPrice,`add ${choice.name}'s max of $`)  \n            }\n            \n        }\n      });\n    }\n    if( this.basePrice !== null ){\n      choicePrice.incr(this.basePrice, `add the base unit price of $${this.basePrice}` ) ;\n    }\n    return choicePrice;\n  }\n  \n  hasBucket(name){\n    return bucketInstances.has(name);\n  }\n  \n  getBucket(name){\n    return bucketInstances.get(name);\n  }\n  \n  hasVariation(name){\n    var idx = dataMap.get( this.id ).variations.findIndex( ( vid )=>{\n      return productInstances.get( vid ).name == name;\n    });\n    return !!~idx;\n  }\n  \n  getVariation(name){\n    var idx = dataMap.get( this.id ).variations.findIndex( ( vid )=>{\n      return productInstances.get( vid ).name == name;\n    });\n    if(~idx){\n      var vid = dataMap.get( this.id ).variations[idx];\n      return productInstances.get( vid );\n    }\n  }\n\n}\n\n\n\nProduct.Variation = class{\n  \n  constructor( id, parent, counts ){\n    this.id = id;\n    this.parent = parent;\n    countersMap.set( this, counts );\n    // productInstances.set(this.id, this );\n  }\n  \n  get name(){\n    var attr = dataMap.get( this.id ).attributes;\n    var name = Object.keys(attr).reduce( ( found, k )=>{\n      if( found ) return found;\n      var a = attr[k];\n      if(/edb/.test(k)){\n        found =  a.replace(/^edb_/,'').replace(/_/g,'-');\n      }\n      return found;\n    }, false );\n    if(!name){\n      return 'Unknown';\n    }\n    return name;\n  }\n  \n  get regularPrice(){\n    return parseFloat(dataMap.get(this.id).display_regular_price);\n  }\n  \n  get salePrice(){\n    var disp = dataMap.get(this.id).display_price;\n    return disp < this.regularPrice ? disp : null;\n    \n  }\n  get price(){\n    return this.salePrice === null ? this.regularPrice : this.salePrice;\n  }\n  \n  \n  get selected(){\n    return !!this.isSelected;  \n  }\n  \n  set selected( bool ){\n    var wasSelected = this.isSelected;\n    if(wasSelected){\n      this.unselect( this.selectedCount );\n    }\n    this.isSelected = !!bool;\n    return true;\n  }\n  \n  get stockCount(){\n    \n    if( this.parent.type == 'bucket'){\n      var v = countersMap.get( this ).getCount( 'stockCount', this.id );\n      if(v > 0){\n        return 'n/a';  \n      }else{\n        return 0;\n      }\n      \n      \n    }\n    \n    return countersMap.get( this ).getCount( 'stockCount', this.id );\n  }\n  \n  get cartCount(){\n    return countersMap.get( this ).getCount( 'cartCount', this.id );\n  }\n  \n  get selectedCount(){\n    return countersMap.get( this ).getCount( 'selectedCount', this.id ) ;\n  }\n\n  select( qty ){\n    return countersMap.get( this ).incrCount( 'selectedCount', this.id, qty, `select a quantity for variation #${this.id} of` );\n  }\n  \n  unselect( qty ){\n    return countersMap.get( this ).decrCount( 'selectedCount', this.id, qty );\n  }\n  \n  incrCartCount( qty ){\n    return countersMap.get( this ).incrCount( 'cartCount', this.id, qty, `added to cart a quantity for variation #${this.id} of` );\n  }\n  \n  decrCartCount( qty ){\n    return countersMap.get( this ).decrCount( 'cartCount', this.id, qty, `removed from cart a quantity for variation #${this.id} of` );\n  }\n  \n  \n\n}\n\nProduct.Choice = class{\n  \n  constructor( attr, parent ){\n    this.name = attr.name;;\n    this.type = attr.variation ? 'variation' : attr.name == 'quantity' ? 'count' : 'bucket';\n    this.options = new Map();\n    this.selected = null;\n    this.parent = parent;\n    if( this.type == 'variation'){\n      attr.options.reduce( ( opts, name )=>{\n        var value;\n        if(parent.hasVariation(name)){\n          value = parent.getVariation( name );  \n        }else{\n          value = name;\n        }\n        opts.set(name, value);\n        return opts;\n      }, this.options );  \n    }\n    if( this.type == 'bucket'){\n      attr.options.reduce( ( opts, name )=>{\n        var value;\n        if(parent.hasBucket(name)){\n          value = parent.getBucket( name );  \n        }else{\n          value = name;\n        }\n        opts.set(name, value);\n        return opts;\n      }, this.options );  \n    }\n    if( this.type == 'count'){\n      this.options.set('min',0);\n      this.options.set('step',1);\n      this.options.set('max',100);\n      this.selected = new PedanticCount.LoggingCount( 0 );\n    }\n  }\n  \n  get minRegularPrice(){\n    if( this.type == 'count'){\n      return 0;\n    }\n    \n    var prices = [];\n    this.options.forEach( ( option, name )=>{\n      if(!isNaN(option.regularPrice)){\n        prices.push( option.regularPrice );  \n      }else{\n        prices.push( 0 );\n      }\n    });\n    \n    return Math.min.apply( Math, prices )  \n  }\n  \n  get maxRegularPrice(){\n    if( this.type == 'count'){\n      return 0;\n    }\n    var prices = [];\n    this.options.forEach( ( option, name )=>{\n      if(!isNaN(option.regularPrice)){\n        prices.push( option.regularPrice );  \n      }else{\n        prices.push( 0 );\n      }\n    });\n    return Math.max.apply( Math, prices )  \n  }\n  \n  get minSalePrice(){\n    if( this.type == 'count'){\n      return 0;\n    }\n    var prices = [];\n    this.options.forEach( ( option, name )=>{\n      if(option.salePrice !== null && !isNaN(option.salePrice)){\n        prices.push( option.salePrice );  \n      }else{\n        prices.push( isNaN(option.regularPrice) ? 0 : option.regularPrice );  \n      }\n    });\n    return Math.min.apply( Math, prices )  \n  }\n  \n  get maxSalePrice(){\n    if( this.type == 'count'){\n      return 0;\n    }\n    var prices = [];\n    this.options.forEach( ( option, name )=>{\n      if(option.salePrice !== null && !isNaN(option.salePrice)){\n        prices.push( option.salePrice );  \n      }else{\n        prices.push( isNaN(option.regularPrice) ? 0 : option.regularPrice );  \n      }\n    });\n    return Math.max.apply( Math, prices )  \n  }\n  \n  get minPrice(){\n    return Math.min( this.minSalePrice, this.minRegularPrice );\n  }\n  \n  get maxPrice(){\n    return Math.max( this.maxSalePrice, this.maxRegularPrice );\n  }\n  \n  get currentPrice(){\n    if( this.type == 'count'){\n      return 0;\n    }\n    var selectedOption = this.selectedOption;\n    if(selectedOption === null ){\n      return null;\n    }\n    return selectedOption.price;\n  }\n  \n  getOption( name ){\n    if(!this.options.has(name)){\n      return null;\n    }\n    return this.options.get( name );\n  }\n  \n  get selectedOption(){\n    if( this.type == 'count'){\n      return this.selected;\n    }\n    if(this.selected === null){\n      return null;\n    }\n    return this.getOption(this.selected);\n  }\n\n  select( choice ){\n    if( this.type == 'count'){\n      if(isNaN(choice)) throw new Error(`Cannot select quantity of \"${choice}\"`);\n      this.selected.incr( choice, `increased the quantity choice by ${choice}` );\n      this.parent.choices.forEach( ( parentChoice, name )=>{\n        if(parentChoice !== this ){\n          if(parentChoice.selected){\n            parentChoice.options.get( parentChoice.selected ).select( this.selected );\n          }else{\n            // console.log('not selected, ignore %s?', name);\n          }\n        }\n      })\n    }else{\n      this.selected = null;\n      this.options.forEach( ( option, name )=>{\n        if( name == choice ){\n           this.selected = name;\n           option.selected = true;\n        }else{\n          option.selected = false;\n        }\n      });  \n    }\n    return true;\n  }\n  \n  unselect( choice ){\n    if( this.type =='count'){\n      if(isNaN(choice) && arguments.length > 0){\n        throw new Error(`Cannot unselect quantity of \"${choice}\"`);\n      }\n      this.selected.decr( choice, `decreased the quantity choice by ${choice}` );\n    }else{\n      var current = this.selectedOption;\n      if(current){\n        // console.log('current',current.selected)\n        current.selected = false;\n      }\n      this.selected = null;  \n    }\n    \n    return true;\n  }\n  \n}\n\nProduct.CompositeChoice = class{\n  \n  constructor( parentChoice, parent ){\n    this.name = parentChoice.name;\n    this.type = parentChoice.type;\n    this.parent = parent;\n    this.parentChoices = new Set();\n    // this.options = new Map();\n    // this.selected = null;\n     \n  }\n  get selected(){\n    var selected = null;\n    if(this.type == 'count'){\n      selected = [];\n      this.parentChoices.forEach( ( parentChoice )=>{\n          selected.push(parentChoice.selected);\n      });\n      return Math.min.apply(Math,selected);\n    }else{\n      this.parentChoices.forEach( ( parentChoice )=>{\n        if( parentChoice.selected !== null ){\n          selected = parentChoice.selected;\n        }\n      });  \n    }\n    \n    return selected;\n  }\n  \n  getOption( name ){\n    if(!this.options.has(name)){\n      return null;\n    }\n    return this.options.get( name );\n  }\n  \n  get selectedOption(){\n    if( this.type == 'count'){\n      return this.selected;\n    }\n    if(this.selected === null){\n      return null;\n    }\n    return this.getOption(this.selected);\n  }\n  \n  get minRegularPrice(){\n    var total = new PedanticCount.LoggingCount( 0 );\n    this.parentChoices.forEach( ( parentChoice )=>{\n      total.incr( parentChoice.minRegularPrice, `add child product #${parentChoice.parent.id}'s min regular price of $`);\n    })\n    return total;\n  }\n  get maxRegularPrice(){\n    var total = new PedanticCount.LoggingCount( 0 );\n    this.parentChoices.forEach( ( parentChoice )=>{\n      total.incr( parentChoice.maxRegularPrice, `add child product #${parentChoice.parent.id}'s max regular price of $`);\n    })\n    return total;\n  }\n  \n  get minSalePrice(){\n    var total = new PedanticCount.LoggingCount( 0 );\n    this.parentChoices.forEach( ( parentChoice )=>{\n      total.incr( parentChoice.minSalePrice, `add child product #${parentChoice.parent.id}'s min sale price of $`);\n    })\n    return total;\n  }\n  \n  get maxSalePrice(){\n    var total = new PedanticCount.LoggingCount( 0 );\n    this.parentChoices.forEach( ( parentChoice )=>{\n      total.incr( parentChoice.maxSalePrice, `add child product #${parentChoice.parent.id}'s max sale price of $`);\n    })\n    return total;\n  }\n  \n\n  \n  get options(){\n    var options = new Map();\n    this.parentChoices.forEach( ( parentChoice )=>{\n      var parentOptions = parentChoice.options;\n      parentOptions.forEach( ( parentOption, name )=>{\n        if(!options.has(name)){\n          options.set( name, new Set() );\n        }\n        options.get(name).add( parentOption );\n      });\n    });\n    return options;\n  }\n  \n  select( choice ){\n    \n    this.parentChoices.forEach( ( parentChoice )=>{\n      // console.log('selected choice', choice, 'on parent', parentChoice.parent.id, parentChoice.name )\n      parentChoice.select( choice );\n    });\n    return true;\n  }\n  \n  unselect( choice ){\n    \n    this.parentChoices.forEach( ( parentChoice )=>{\n      // console.log('unselected choice', choice, 'on parent', parentChoice.parent.id, parentChoice.name )\n      parentChoice.unselect( choice );\n    });\n    return true;\n  }\n  \n  add( parentChoice ){\n    this.parentChoices.add( parentChoice );\n  }\n  \n  \n}\nclass BaseProduct extends Product{\n  \n  constructor( id, counts, cart ){\n    super( id, counts, cart );\n    \n    Object.defineProperty( this, 'selected', { enumerable: true, configurable: true, value: this.selections } );\n    // Object.defineProperty(,{ enumerable: true })\n    // this.selectedVariation=null;\n    // this.selectedBucket=null;\n  }\n  \n  get variations(){\n    return dataMap.get( this.id ).variations.map( ( vid )=>{\n      return productInstances.get( vid );\n    });\n  }\n  \n  get choices(){\n    if(choiceMap.has(this)) return choiceMap.get(this);\n    var attrs = dataMap.get( this.id ).attributes;\n    if(!attrs) return null;\n    var choices = new Map();\n    choices.set( 'quantity', new Product.Choice( { name: 'quantity' }, this ) );\n    attrs.reduce( ( obj, attr )=>{\n      obj.set( attr.name, new Product.Choice( attr, this ) );\n      return obj;\n    }, choices );\n    choiceMap.set(this, choices );\n    return choices;\n  }\n  \n  get selections(){\n    return Array.from(this.choices.keys()).reduce( ( o, key )=>{\n      o[key] = this.choices.get(key).selected;\n      return o;\n    }, {} )\n  }\n  \n \n  get hasValidSelections(){\n    var selections = this.selections;\n    return Object.keys( selections ).every( ( key )=>{\n      return key != 'quantity' ?  selections[key] !== null : true;\n    });\n  }\n \n  \n  get stockCount(){\n    var selectedOptionStock = null;\n    var source = null;\n    this.choices.forEach( ( choice, name )=>{\n      if(name !== 'quantity'){\n        var selectedOption = choice.selectedOption;\n        if(selectedOption){\n          // console.log(selectedOption.stockCount)\n          if(selectedOption.stockCount == 'n/a'){\n            return selectedOptionStock;\n          }\n          selectedOptionStock = selectedOption.stockCount;\n          source = selectedOption;\n        }\n      }\n    });\n    if(selectedOptionStock === null ){\n        return this.variations.reduce( ( t, v )=>{\n          t.incr( v.stockCount, `include product #${this.id}'s variation #${v.id}'s stockCount of` );\n          return t;\n        },new PedanticCount.LoggingCount( 0 ) );  \n    }\n    // console.log( 'stockCount(BASE#%s)', this.id, selectedOptionStock, source.parent)\n    return selectedOptionStock;\n  }\n  \n  get cartCount(){\n    if(this.selectedVariation){\n     \n      return this.getVariation(this.selectedVariation).cartCount;\n    }else{\n      return this.variations.reduce( ( t, v )=>{\n        t.incr( v.cartCount, `include product#${this.id} variation#${v.id} cartCount of` );\n        return t;\n      },new PedanticCount.LoggingCount( 0 ) );\n    }\n  }\n  \n  get selectedCount(){\n    \n   if(this.selectedVariation){\n       return this.getVariation(this.selectedVariation).selectedCount;\n   }else{\n      return this.variations.reduce( ( t, v )=>{\n         t.incr( v.selectedCount, `include product#${this.id} variation#${v.id}'s selectedCount of` );\n        return t;\n      }, new PedanticCount.LoggingCount( 0 ) );\n   }\n\n  }\n  \n  \n\n\n  select( options = {} ){\n    // console.log('select', this.type, options );\n    this.choices.forEach( ( choice, name )=>{\n      if(~Object.keys(options).indexOf(name)){\n        choice.select( options[name] );\n      }\n    });\n    return true;\n  }\n  \n  unselect( options = {} ){\n    \n    \n    this.choices.forEach( ( choice, name )=>{\n      if(~Object.keys(options).indexOf(name)){\n        \n        choice.unselect( options[name] );\n      }\n    });\n    return true;\n  }\n  \n  reset(){\n    \n    var unsel = Object.assign( {}, this.selections, {quantity: this.choices.get('quantity').selected } );\n    // console.log('reset %d', this.id, unsel );\n    this.unselect( unsel);\n    return true;\n  }\n  \n  addToCart(){\n    var selectedQty = this.choices.get('quantity').selected;\n    if(selectedQty === 0 ) return new Error('Cannot add to cart, quantity missing');\n    if( !this.hasValidSelections ){\n      return new Error('Cannot add to cart, selections are missing');\n    }\n    \n    \n    \n    cartMap.get(this).addItem( this );\n    return this.reset();\n    \n        \n  }\n\n  \n  \n}\n\n\n\nclass CompositeProduct extends BaseProduct{\n  \n  get parents(){\n    var gids = dataMap.get( this.id ).meta_box.edb_group_ids;\n    var gids = gids.split(',').map((s)=>{ return parseInt(s.trim())  });\n    return gids.map( ( gid )=>{\n      \n      return productInstances.get( gid );\n    });\n  }\n  \n  get choices(){\n    if(choiceMap.has(this)) return choiceMap.get(this);\n    var compositeChoices = new Map();\n    return this.parents.reduce( ( comps, parent )=>{\n      parent.choices.forEach( ( parentChoice, name )=>{\n        if(!comps.has(name)){\n          comps.set( name, new Product.CompositeChoice( parentChoice , this ) );\n        }\n        comps.get(name).add( parentChoice );  \n        \n      });\n      return comps;\n    }, compositeChoices );\n  }\n  \n  get stockCount(){\n    var counts = [];\n    this.parents.forEach( ( parent)=>{\n      if(parent.stockCount !== 'n/a'){\n        counts.push( parent.stockCount );\n        // console.log('parent[%d].cartCount',parent.id,parent.cartCount)\n        // console.log('parent[%d].stockCount',parent.id,parent.stockCount)\n      }\n    });\n    // console.log('counts', counts)\n    return Math.min.apply( Math, counts);\n  }\n  \n  get cartCount(){\n    return Math.min.apply( Math, this.parents.map( (parent)=>{\n      return parent.cartCount;\n    }));\n  }\n  \n  get selectedCount(){\n    return this.parents.reduce( ( t, parent)=>{\n      return t + (parent.selectedCount ? 1 : 0);\n    },0)/this.parents.length ;\n  }\n  \n  get basePrice(){\n    return this.parents.reduce( (t, parent )=>{\n      return t + ( parent.basePrice === null ? 0 : parent.basePrice);\n    },0)\n  }\n  \n  get minRegularPrice(){\n    \n    var value =  this.parents.reduce( (t, parent )=>{\n      return t + parent.minRegularPrice;\n    },0)\n    // console.log('minRegularPrice', value)\n    return value;\n  }\n  \n  get maxRegularPrice(){\n    return this.parents.reduce( (t, parent )=>{\n      return t + parent.maxRegularPrice;\n    },0)\n  }\n  \n  get minSalePrice(){\n    return this.parents.reduce( (t, parent )=>{\n      return t + parent.minSalePrice;\n    },0)\n  }\n  \n  get maxSalePrice(){\n    return this.parents.reduce( (t, parent )=>{\n      return t + parent.maxSalePrice;\n    },0)\n  }\n  \n  get currentPrice(){\n    return this.parents.reduce( (choicePrice, parent )=>{\n        if( parent.choices){\n          parent.choices.forEach( ( choice, name )=>{\n            if(name !== 'quantity'){\n              var selected = this.choices.get(choice.name).selected;\n              if(selected !== null){\n                var option = choice.getOption(selected);\n                choicePrice.incr(option.price,`add ${name}'s current price of $`)  \n              }\n                \n            }\n          });\n        }\n        if( parent.basePrice !== null ){\n          choicePrice.incr(parent.basePrice, `add the base unit price of $${parent.basePrice}` ) ;\n        }\n        return choicePrice;\n      \n      \n    },new PedanticCount.LoggingCount(0 ) );\n  }\n  \n  \n  \n  unselect( options = {} ){\n    this.choices.forEach( ( choice, name )=>{\n      if(~Object.keys(options).indexOf(name)){\n        var parentChoices = this.choices.get(name).parentChoices;\n        parentChoices.forEach( ( choice )=>{\n          choice.unselect( options[name] );\n        })\n      }\n    });\n    return true;\n\n  }\n  // selectQuantity( qty ){\n  //   return this.parents.reduce( ( success, parent )=>{\n  //     if(!success) return success;\n  //     return parent.selectQuantity( qty );\n  //   }, true );\n    \n  // }\n  \n  // selectVariation( name ){\n  //   return this.parents.reduce( ( success, parent )=>{\n  //     if(!success) return success;\n  //     return parent.selectVariation( name );\n  //   }, (this.selectedVariation = name) );\n  // }\n}\nclass BucketProduct extends BaseProduct{\n  constructor( id, counts ){\n    super( id, counts );\n    this.selectedVariation=null;\n    this.variations.forEach( ( v )=>{\n      bucketInstances.set(v.name,v);\n    });\n  }\n  \n}\n\n\nclass EDBCatalogBrain{\n  \n  constructor(){\n    this.counts.createIndex('stockCount');\n    this.counts.createVirtual('cartCount', 0);\n    this.counts.createVirtual('selectedCount', 0);\n    \n    this.counts.link('stockCount','selectedCount');\n    this.counts.link('stockCount','cartCount');\n    this.cart = new Cart( this.counts );\n    \n  }\n  \n  \n  \n  get counts(){\n    return PedanticCount.CountIndex;\n  }\n  \n  get categories(){\n    return Array.from( catMap.keys() );\n  }\n  \n  get catalog(){\n    return this.categories.reduce( ( mapped, cat )=>{\n      mapped.set(cat, Array.from(catMap.get(cat).values()).reduce( ( map, id )=>{\n        map.set(id,this.getProduct( id ));\n        return map;\n      }, new Map() ));\n      return mapped;\n    }, new Map() );\n  }\n  \n  \n  \n  getProduct( id ){\n      var type = typeMap.get(id);\n      if(productInstances.has(id)){\n        return productInstances.get(id);\n      }else{\n        switch( type ){\n          case 'normal':\n            productInstances.set(id, new Product( id, this.counts, this.cart ) );\n          break;\n          case 'base':\n            productInstances.set(id, new BaseProduct( id, this.counts, this.cart ) );\n          break;\n          case 'composite':\n            productInstances.set(id, new CompositeProduct( id, this.counts, this.cart ) );\n          break;\n          case 'bucket':\n            productInstances.set(id, new BucketProduct( id, this.counts,this.cart ) );\n          break;\n        }\n      }\n      return productInstances.get(id);\n  }\n  \n  importVariations(json){\n    \n    json.variation_data.forEach( ( v )=>{\n      var id = v.variation_id;\n      dataMap.set( id, v );\n      this.counts.setCount( 'stockCount', id, v.stock );\n    });\n    \n  }\n  \n  importCategories( json ){\n    \n    let cats = json.categories;\n    cats.forEach( ( cat )=>{\n      dataMap.set( cat.slug, cat );\n      if(!catMap.has(cat.slug)){\n        catMap.set(cat.slug, new Set() );\n      }\n      catMap.get(cat.slug).add( json.id );\n    });\n    \n  }\n  \n  importTypes( json ){\n    // console.log(json.meta_box)\n    if( json.meta_box && json.meta_box.edb_group_ids){\n      typeMap.set( json.id, 'composite');\n      return 'composite';\n    }else if( json.meta_box && json.meta_box.edb_bucket_slug){\n      typeMap.set( json.id, 'bucket');\n      return 'bucket';\n    }else if( json.meta_box && json.meta_box.edb_base_price && json.meta_box.edb_base_price != ''){\n      typeMap.set( json.id, 'base');\n      return 'base';\n    }else{\n      typeMap.set( json.id, 'normal');\n      return 'normal';\n    }\n    \n  }\n  \n  \n  \n  import( json ){\n    if(Array.isArray(json)){\n      return json.map( ( item )=>{\n        return this.import( item );\n      })\n    }\n    var type = this.importTypes( json );\n    this.importCategories( json );\n    if(json.variation_data){\n      this.importVariations( json );  \n    }\n    dataMap.set( json.id, json );\n    if(type == 'bucket' ){\n      this.getProduct( json.id );\n    }\n    \n  }\n  \n}\nmodule.exports = EDBCatalogBrain;"]}